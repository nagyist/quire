{% comment %}
    Template for the "Cite this Page" feature. Called as a
    partial, such as:

    partial "cite-this" (dict "type" "chicago" "range" "page")

    {% render "citation/index", type: "chicago", range: "page" %}

    Can accept "chicago" or "mla" as a type

    Can accept "page" or "site" as a range

    Follows standard of using "et al" for more than ten
    authors in Chicago citations, and more than two authors
    in MLA citations.

    ***Note***
    Edit this template with care as it is easy to introduce stray spaces occuring around punctuation.
{% endcomment %}

{% comment %}
TODO use regex filter or calculated data
{% endcomment %}
{%- $endPunctuation := findRE "[!|?]$" publication.title -%}
{% $seriesStartNumber := findRE "^[0-9]" publication.number_in_series %}

{% comment %} ------------  CHICAGO ------------ {% endcomment %}
{%- if type === "chicago" -%}

  {%- if range === "page" -%}

    {% if contributor %}{% render "citation/chicago/page-contributors", "contributor": contributor %}. {% endif %}{% if title %}“{% render "page-title", title: title, subtitle: subtitle %}.” {% elsif label %}“{{ label }}.” {% else %}Untitled. {% endif %}In <em>{% include "site-title" %}</em>{% if publicationAuthorCount > 0 %}, {% if publicationEditorCount > 0 %}edited {% endif %}by {% render "citation/chicago/publication-contributors" for publicationAuthors as contributor %}{% endif %}. {% render 'citation/chicago/publisher' for publication.publisher as publisher %}{% if publication.pub_date %}, {{ publication.pub_date | date: "%Y" }}{% end %}. <span class="url-string">{% if publication.identifier.url %}{% publication.identifier.url %}{{ permalink }}{% else %}{{ permalink }}{% endif %}</span>.

  {%- elsif range === "site" -%}

    {% include "publication-contributors", type: type %}. <em>{% publication.title %}{% if publication.subtitle %}{% if $endPunctuation %} {% else %}: {% endif %}{{ publication.subtitle }}{% endif %}.</em> {% if publication.series %}{% publication.series %}{% if publication.number_in_series %}{% if $seriesStartNumber %} {% else %}, {% endif %}{{ publication.number_in_series }}{% endif %}.{% endif %} {% render 'citation/chicago/publisher' for publication.publisher as publisher %}{% if publication.pub_date %}, {{ publication.pub_date | date: "%Y" }}{% endif %}.{% if publication.identifier.url %} <span class="url-string">{{ publication.identifier.url }}</span>.{% endif %}

  {%- endif -%}

{% comment %} ------------  MLA ------------ {% endcomment %}
{%- elsif type === "mla" -%}

  {%- if range === "page" -%}

    {% if contributor %}{% render "citation/mla/page-contributors", contributor: contributor %}. {% endif %}{% if title %}“{% render "page-title", title: title, subtitle: subtitle %}.” {% elsif label %}“{{ label }}.” {% else %}Untitled. {% endif %}<em>{% include "site-title" %}</em>{% if publicationAuthorCount > 0 %}, {% if publicationEditorCount > 0 %}edited {% endif %}by {% render "citation/mla/publication-contributors" %}{% endif %}. {% render "citation/mla/publishers" for publication.publisher as publisher %}{% if publication.pub_date %}, {{ publication.pub_date | date: "%Y" }}{% endif %}. <span class="url-string">{% if publication.identifier.url %}{% publication.identifier.url %}{{ permalink }}{% else %}{{ permalink }}{% endif %}</span>. Accessed <span class="cite-current-date">DD Mon. YYYY</span>.

  {%- elsif range === "site" -%}

    {% include "publication-contributors", type: type %}. <em>{% publication.title %}{% if publication.subtitle %}{% if $endPunctuation %} {% else %}: {% endif %}{{ publication.subtitle }}{% endif %}.</em> {% if publication.series %}{% publication.series %}{% if publication.number_in_series %}{% if $seriesStartNumber %} {% else %}, {% endif %}{{ publication.number_in_series }}{% endif %}.{% endif %} {% render "citation/mla/publishers" for publication.publisher as publisher %}{% if publication.pub_date %}, {{ publication.pub_date | date: "%Y" }}{% endif %}.{% if publication.identifier.url %} <span class="url-string">{{ publication.identifier.url }}</span>{% endif %}. Accessed <span class="cite-current-date">DD Mon. YYYY</span>.

  {%- endif -%}

{%- endif -%}
